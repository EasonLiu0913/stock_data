<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Â§ñË≥áÈÄ£Á∫åË≤∑Ë∂ÖËÇ°Á•®</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        h1 {
            color: #2d3748;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            overflow-x: auto; /* Allow horizontal scrolling */
            -webkit-overflow-scrolling: touch; /* Smooth scrolling on iOS */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px; /* Ensure table doesn't get too squeezed */
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 1.2rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        tbody tr {
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.2s ease;
        }

        tbody tr:hover {
            background-color: #f7fafc;
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        td {
            padding: 1rem 1.2rem;
            color: #2d3748;
        }

        .stock-code {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1rem;
        }

        .stock-code a {
            color: #667eea;
            text-decoration: none;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }

        .stock-code a:hover {
            color: #764ba2;
            border-bottom: 2px solid #764ba2;
        }

        .positive {
            color: #e53e3e;
            font-weight: 600;
        }

        .negative {
            color: #38a169;
            font-weight: 600;
        }

        .neutral {
            color: #2d3748;
            font-weight: 600;
        }

        .day-values {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .day-value {
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            background: #e6fffa;
            color: #234e52;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: white;
            font-size: 1.2rem;
        }

        .sort-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sort-container label {
            color: #2d3748;
            font-weight: 600;
            font-size: 1rem;
        }

        .sort-container select {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: #2d3748;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }

        .sort-container select:hover {
            border-color: #667eea;
        }

        .sort-container select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .error {
            background: #fed7d7;
            color: #742a2a;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem 0.5rem; /* Reduce side padding on mobile */
            }

            .container {
                width: 100%;
                overflow-x: hidden; /* Prevent body scroll from container overflow */
            }

            .header {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
                border-radius: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .stats {
                grid-template-columns: 1fr 1fr; /* 2 columns on mobile */
                gap: 0.8rem;
            }
            
            .stat-card {
                padding: 1rem;
            }
            
            .stat-value {
                font-size: 1.8rem;
            }

            .sort-container {
                flex-direction: column;
                align-items: stretch;
                padding: 1rem;
            }

            .sort-container label {
                margin-bottom: 0.5rem;
            }

            .sort-container select {
                width: 100%;
            }

            table {
                font-size: 0.9rem;
            }

            th, td {
                padding: 0.8rem 0.5rem; /* Reduce cell padding */
                white-space: nowrap; /* Keep content on one line for scrolling */
            }

            .day-values {
                flex-direction: column;
            }
        }
        
        @media (max-width: 480px) {
             .stats {
                grid-template-columns: 1fr; /* 1 column on very small screens */
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üéØ Â§ñË≥áÈÄ£Á∫åË≤∑Ë∂ÖËÇ°Á•®</h1>
            <p class="subtitle">ÁØ©ÈÅ∏Ê¢ù‰ª∂ÔºöÂ§ñË≥áËøë 4 Â§©ÈÄ£Á∫åË≤∑Ë∂ÖÔºàÂâçÂõõÂÄãÊï∏Â≠óÈÉΩÊòØÊ≠£Êï∏Ôºâ</p>
            <p class="subtitle" id="dataDate" style="color: #667eea; font-weight: 600; margin-top: 0.5rem;"></p>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalStocks">-</div>
                <div class="stat-label">Á¨¶ÂêàÊ¢ù‰ª∂ËÇ°Á•®Êï∏</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalBuy">-</div>
                <div class="stat-label">4Êó•Á¥ØË®àË≤∑Ë∂ÖÔºàÂºµÔºâ</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgBuy">-</div>
                <div class="stat-label">Âπ≥ÂùáÊØèÊó•Ë≤∑Ë∂ÖÔºàÂºµÔºâ</div>
            </div>
        </div>

        <div class="sort-container">
            <label for="sortSelect">ÊéíÂ∫èÊñπÂºèÔºö</label>
            <select id="sortSelect" onchange="sortStocks()">
                <option value="total">4Êó•Á¥ØË®àÔºàÂæûÂ§öÂà∞Â∞ëÔºâ</option>
                <option value="growth">Á¨¨1Â§©‚ÜíÁ¨¨2Â§©ÊàêÈï∑ÁéáÔºàÂæûÂ§ßÂà∞Â∞èÔºâ</option>
                <option value="three-days">ÂõõÂ§©‰∏≠Êúâ‰∏âÂ§©Âú®Ë≤∑Ôºà4Êó•Á¥ØË®àÂæûÂ§ßÂà∞Â∞èÔºâ</option>
            </select>
        </div>

        <div class="table-container">
            <div id="loading" class="loading">ËºâÂÖ•‰∏≠...</div>
            <div id="error" style="display: none;"></div>
            <table id="stockTable" style="display: none;">
                <thead>
                    <tr>
                        <th>ËÇ°Á•®‰ª£Ëôü</th>
                        <th>ËÇ°Á•®ÂêçÁ®±</th>
                        <th>Á¨¨1Â§©</th>
                        <th>Á¨¨2Â§©</th>
                        <th>Á¨¨3Â§©</th>
                        <th>Á¨¨4Â§©</th>
                        <th>4Êó•Á¥ØË®à</th>
                        <th>Âπ≥ÂùáÊØèÊó•</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let allFilteredStocks = []; // ÂÑ≤Â≠òÊâÄÊúâÁ¨¶ÂêàÊ¢ù‰ª∂ÁöÑËÇ°Á•®Ë≥áÊñô

        async function loadData() {
            try {
                // Ëá™ÂãïÂÅµÊ∏¨Áí∞Â¢ÉÔºöGitHub Pages ÊàñÊú¨Âú∞ÈñãÁôº
                // GitHub Pages: /stock_data/data_fubon/...
                // Êú¨Âú∞: ../data_fubon/...
                const isGitHubPages = window.location.hostname.includes('github.io');
                const basePath = isGitHubPages ? '/stock_data' : '..';
                const dataPath = `${basePath}/data_fubon/fubon_20260121_stock_data.json`;
                
                const response = await fetch(dataPath);
                if (!response.ok) {
                    throw new Error('ÁÑ°Ê≥ïËºâÂÖ•Ë≥áÊñô');
                }
                
                // ÂæûÊ™îÂêçÊèêÂèñÊó•Êúü (ÂÅáË®≠Ê†ºÂºè: ...fubon_YYYYMMDD_stock_data.json)
                const dateMatch = dataPath.match(/fubon_(\d{8})_stock_data\.json/);
                if (dateMatch && dateMatch[1]) {
                    const dateStr = dateMatch[1];
                    const formattedDate = `${dateStr.substring(0, 4)}/${dateStr.substring(4, 6)}/${dateStr.substring(6, 8)}`;
                    document.getElementById('dataDate').textContent = `Ë≥áÊñôÊó•ÊúüÔºö${formattedDate}`;
                }

                const data = await response.json();
                
                // ËºâÂÖ•ÊâÄÊúâÊúâ ForeignInvestors Ë≥áÊñôÁöÑËÇ°Á•®ÔºàËá≥Â∞ë 4 Â§©Ôºâ
                allFilteredStocks = [];
                
                for (const [stockCode, stockData] of Object.entries(data)) {
                    const foreignInvestors = stockData.ForeignInvestors;
                    
                    // Ê™¢Êü•ÊòØÂê¶Êúâ ForeignInvestors Ë≥áÊñô‰∏îËá≥Â∞ëÊúâ 4 Â§©
                    if (foreignInvestors && foreignInvestors.length >= 4) {
                        const firstFour = foreignInvestors.slice(0, 4);
                        const total = firstFour.reduce((sum, val) => sum + val, 0);
                        const average = Math.round(total / 4);
                        
                        // Ë®àÁÆóÁ¨¨1Â§©Âà∞Á¨¨2Â§©ÁöÑÊàêÈï∑Áéá
                        const growthRate = firstFour[1] !== 0 
                            ? ((firstFour[0] - firstFour[1]) / Math.abs(firstFour[1]) * 100)
                            : 0;
                        
                        allFilteredStocks.push({
                            code: stockCode,
                            name: stockData.StockName || '',
                            day1: firstFour[0],
                            day2: firstFour[1],
                            day3: firstFour[2],
                            day4: firstFour[3],
                            total: total,
                            average: average,
                            growthRate: growthRate
                        });
                    }
                }
                
                // ÂàùÂßãÊéíÂ∫èÔºàÊåâ 4 Êó•Á¥ØË®àÔºâ
                sortStocks();
                
                // Êõ¥Êñ∞Áµ±Ë®àË≥áË®ä
                updateStats();
                
                // È°ØÁ§∫Ë°®Ê†ºÔºåÈö±ËóèËºâÂÖ•‰∏≠
                document.getElementById('loading').style.display = 'none';
                document.getElementById('stockTable').style.display = 'table';
                
            } catch (error) {
                console.error('ËºâÂÖ•Ë≥áÊñôÊôÇÁôºÁîüÈåØË™§:', error);
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.style.display = 'block';
                errorDiv.className = 'error';
                errorDiv.textContent = 'ËºâÂÖ•Ë≥áÊñôÊôÇÁôºÁîüÈåØË™§: ' + error.message;
            }
        }

        function sortStocks() {
            const sortBy = document.getElementById('sortSelect').value;
            
            let stocksToDisplay = [];
            
            if (sortBy === 'total') {
                // ÁØ©ÈÅ∏Âá∫ÂâçÂõõÂ§©ÈÉΩÊòØÊ≠£Êï∏ÁöÑËÇ°Á•®
                stocksToDisplay = allFilteredStocks.filter(stock => {
                    return stock.day1 > 0 && stock.day2 > 0 && stock.day3 > 0 && stock.day4 > 0;
                });
                // ÊåâÁÖß 4 Êó•Á¥ØË®àÊéíÂ∫èÔºàÁî±Â§ßÂà∞Â∞èÔºâ
                stocksToDisplay.sort((a, b) => b.total - a.total);
            } else if (sortBy === 'growth') {
                // ÁØ©ÈÅ∏Âá∫ÂâçÂõõÂ§©ÈÉΩÊòØÊ≠£Êï∏ÁöÑËÇ°Á•®
                stocksToDisplay = allFilteredStocks.filter(stock => {
                    return stock.day1 > 0 && stock.day2 > 0 && stock.day3 > 0 && stock.day4 > 0;
                });
                // ÊåâÁÖßÊàêÈï∑ÁéáÊéíÂ∫èÔºàÁî±Â§ßÂà∞Â∞èÔºâ
                stocksToDisplay.sort((a, b) => b.growthRate - a.growthRate);
            } else if (sortBy === 'three-days') {
                // ÁØ©ÈÅ∏Âá∫ÂõõÂ§©‰∏≠Ëá≥Â∞ëÊúâ‰∏âÂ§©ÊòØÊ≠£Êï∏ÁöÑËÇ°Á•®
                stocksToDisplay = allFilteredStocks.filter(stock => {
                    const positiveDays = [stock.day1, stock.day2, stock.day3, stock.day4].filter(val => val > 0).length;
                    return positiveDays >= 3;
                });
                // ÊåâÁÖß 4 Êó•Á¥ØË®àÊéíÂ∫èÔºàÁî±Â§ßÂà∞Â∞èÔºâ
                stocksToDisplay.sort((a, b) => b.total - a.total);
            }
            
            // ÈáçÊñ∞Ê∏≤ÊüìË°®Ê†º
            renderTable(stocksToDisplay);
            
            // Êõ¥Êñ∞Áµ±Ë®àË≥áË®ä
            updateStats(stocksToDisplay);
        }

        function renderTable(stocks = allFilteredStocks) {
            const tableBody = document.getElementById('tableBody');
            tableBody.innerHTML = '';
            
            // Ê†πÊìöÊï∏ÂÄºÊ±∫ÂÆöÈ°èËâ≤È°ûÂà•ÁöÑÂáΩÊï∏
            const getColorClass = (value) => {
                if (value > 0 && value < 1000) {
                    return 'neutral';  // Ê≠£Êï∏‰ΩÜÂ∞èÊñº 1000ÔºåÁî®ÈªëËâ≤
                } else if (value > 0) {
                    return 'positive'; // Ê≠£Êï∏‰∏î >= 1000ÔºåÁî®Á¥ÖËâ≤
                } else if (value < 0) {
                    return 'negative'; // Ë≤†Êï∏ÔºåÁî®Á∂†Ëâ≤
                } else {
                    return '';         // 0ÔºåÁÑ°ÁâπÊÆäÈ°èËâ≤
                }
            };
            
            stocks.forEach(stock => {
                const row = document.createElement('tr');
                
                // Ê†πÊìöÊï∏ÂÄºÊ≠£Ë≤†Ë®≠ÂÆöÈ°èËâ≤È°ûÂà•
                const day1Class = getColorClass(stock.day1);
                const day2Class = getColorClass(stock.day2);
                const day3Class = getColorClass(stock.day3);
                const day4Class = getColorClass(stock.day4);
                const totalClass = getColorClass(stock.total);
                const avgClass = getColorClass(stock.average);
                
                row.innerHTML = `
                    <td class="stock-code"><a href="https://fubon-ebrokerdj.fbs.com.tw/z/zc/zcw/zcw1_${stock.code}.djhtm" target="_blank">${stock.code}</a></td>
                    <td>${stock.name}</td>
                    <td class="${day1Class}">${stock.day1.toLocaleString()}</td>
                    <td class="${day2Class}">${stock.day2.toLocaleString()}</td>
                    <td class="${day3Class}">${stock.day3.toLocaleString()}</td>
                    <td class="${day4Class}">${stock.day4.toLocaleString()}</td>
                    <td class="${totalClass}" style="font-weight: bold;">${stock.total.toLocaleString()}</td>
                    <td class="${avgClass}">${stock.average.toLocaleString()}</td>
                `;
                tableBody.appendChild(row);
            });
        }

        function updateStats(stocks = allFilteredStocks) {
            const totalBuy = stocks.reduce((sum, stock) => sum + stock.total, 0);
            const avgBuy = stocks.length > 0 ? Math.round(totalBuy / stocks.length) : 0;
            
            document.getElementById('totalStocks').textContent = stocks.length;
            document.getElementById('totalBuy').textContent = totalBuy.toLocaleString();
            document.getElementById('avgBuy').textContent = avgBuy.toLocaleString();
        }
        
        // È†ÅÈù¢ËºâÂÖ•ÊôÇÂü∑Ë°å
        loadData();
    </script>
</body>
</html>
