<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¤–è³‡é€£çºŒè²·è¶…è‚¡ç¥¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 2rem;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        .header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 2rem;
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
        }

        h1 {
            color: #2d3748;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .subtitle {
            color: #718096;
            font-size: 1.1rem;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
        }

        .stat-value {
            font-size: 2.5rem;
            font-weight: bold;
            color: #667eea;
            margin-bottom: 0.5rem;
        }

        .stat-label {
            color: #718096;
            font-size: 0.9rem;
        }

        .table-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            overflow: hidden;
            overflow-x: auto;
            /* Allow horizontal scrolling */
            -webkit-overflow-scrolling: touch;
            /* Smooth scrolling on iOS */
        }

        table {
            width: 100%;
            border-collapse: collapse;
            min-width: 600px;
            /* Ensure table doesn't get too squeezed */
        }

        thead {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        th {
            padding: 1.2rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.95rem;
            letter-spacing: 0.5px;
        }

        tbody tr {
            border-bottom: 1px solid #e2e8f0;
            transition: background-color 0.2s ease;
        }

        tbody tr:hover {
            background-color: #f7fafc;
        }

        tbody tr:last-child {
            border-bottom: none;
        }

        td {
            padding: 1rem 1.2rem;
            color: #2d3748;
        }

        .stock-code {
            font-weight: 600;
            color: #667eea;
            font-size: 1.1rem;
        }

        .stock-code a {
            color: #667eea;
            text-decoration: none;
            transition: all 0.2s ease;
            border-bottom: 2px solid transparent;
        }

        .stock-code a:hover {
            color: #764ba2;
            border-bottom: 2px solid #764ba2;
        }

        .positive {
            color: #e53e3e;
            font-weight: 600;
        }

        .negative {
            color: #38a169;
            font-weight: 600;
        }

        .neutral {
            color: #2d3748;
            font-weight: 600;
        }

        .day-values {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }

        .day-value {
            padding: 0.3rem 0.6rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 500;
            background: #e6fffa;
            color: #234e52;
        }

        .loading {
            text-align: center;
            padding: 3rem;
            color: white;
            font-size: 1.2rem;
        }

        .sort-container {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1.5rem;
            border-radius: 15px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);
            margin-bottom: 2rem;
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .sort-container label {
            color: #2d3748;
            font-weight: 600;
            font-size: 1rem;
        }

        .sort-container select {
            padding: 0.75rem 1.5rem;
            border: 2px solid #e2e8f0;
            border-radius: 10px;
            background: white;
            color: #2d3748;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            outline: none;
        }

        .sort-container select:hover {
            border-color: #667eea;
        }

        .sort-container select:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .error {
            background: #fed7d7;
            color: #742a2a;
            padding: 1rem;
            border-radius: 10px;
            margin: 1rem 0;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem 0.5rem;
                /* Reduce side padding on mobile */
            }

            .container {
                width: 100%;
                overflow-x: hidden;
                /* Prevent body scroll from container overflow */
            }

            .header {
                padding: 1.5rem;
                margin-bottom: 1.5rem;
                border-radius: 15px;
            }

            h1 {
                font-size: 1.5rem;
            }

            .subtitle {
                font-size: 0.9rem;
            }

            .stats {
                grid-template-columns: 1fr 1fr;
                /* 2 columns on mobile */
                gap: 0.8rem;
            }

            .stat-card {
                padding: 1rem;
            }

            .stat-value {
                font-size: 1.8rem;
            }

            .sort-container {
                flex-direction: column;
                align-items: stretch;
                padding: 1rem;
            }

            .sort-container label {
                margin-bottom: 0.5rem;
            }

            .sort-container select {
                width: 100%;
            }

            table {
                font-size: 0.9rem;
            }

            th,
            td {
                padding: 0.8rem 0.5rem;
                /* Reduce cell padding */
                white-space: nowrap;
                /* Keep content on one line for scrolling */
            }

            .day-values {
                flex-direction: column;
            }
        }

        @media (max-width: 480px) {
            .stats {
                grid-template-columns: 1fr;
                /* 1 column on very small screens */
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ¯ å¤–è³‡é€£çºŒè²·è¶…è‚¡ç¥¨</h1>
            <p class="subtitle" id="dataDate" style="color: #667eea; font-weight: 600; margin-top: 0.5rem;"></p>
        </div>

        <div class="stats" id="stats">
            <div class="stat-card">
                <div class="stat-value" id="totalStocks">-</div>
                <div class="stat-label">ç¬¦åˆæ¢ä»¶è‚¡ç¥¨æ•¸</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="totalBuy">-</div>
                <div class="stat-label">4æ—¥ç´¯è¨ˆè²·è¶…ï¼ˆå¼µï¼‰</div>
            </div>
            <div class="stat-card">
                <div class="stat-value" id="avgBuy">-</div>
                <div class="stat-label">å¹³å‡æ¯æ—¥è²·è¶…ï¼ˆå¼µï¼‰</div>
            </div>
        </div>

        <div class="sort-container">
            <label for="sortSelect">æ’åºæ–¹å¼ï¼š</label>
            <select id="sortSelect" onchange="sortStocks()">
                <option value="consecutive" selected>é€£çºŒæœ€å¤šå¤©è²·è¶…æ’è¡Œ</option>
                <option value="total">4æ—¥ç´¯è¨ˆï¼ˆå¾å¤šåˆ°å°‘ï¼‰</option>
                <option value="growth">ç¬¬1å¤©â†’ç¬¬2å¤©æˆé•·ç‡ï¼ˆå¾å¤§åˆ°å°ï¼‰</option>
                <option value="three-days">å››å¤©ä¸­æœ‰ä¸‰å¤©åœ¨è²·ï¼ˆ4æ—¥ç´¯è¨ˆå¾å¤§åˆ°å°ï¼‰</option>
            </select>
        </div>

        <div class="table-container">
            <div id="loading" class="loading">è¼‰å…¥ä¸­...</div>
            <div id="error" style="display: none;"></div>
            <table id="stockTable" style="display: none;">
                <thead id="tableHead">
                    <tr>
                        <th>è‚¡ç¥¨ä»£è™Ÿ</th>
                        <th>è‚¡ç¥¨åç¨±</th>
                        <th>é€£çºŒå¤©æ•¸</th>
                        <th>ç¬¬1å¤©</th>
                        <th>ç¬¬2å¤©</th>
                        <th>ç¬¬3å¤©</th>
                        <th>ç¬¬4å¤©</th>
                        <th>ç¬¬5å¤©</th>
                        <th>ç¬¬6å¤©</th>
                        <th>ç¬¬7å¤©</th>
                        <th>ç¬¬8å¤©</th>
                        <th>ç¬¬9å¤©</th>
                        <th>ç¬¬10å¤©</th>
                        <th>10æ—¥ç´¯è¨ˆ</th>
                        <th>10æ—¥å¹³å‡</th>
                    </tr>
                </thead>
                <tbody id="tableBody">
                </tbody>
            </table>
        </div>
    </div>

    <script>
        let allFilteredStocks = []; // å„²å­˜æ‰€æœ‰ç¬¦åˆæ¢ä»¶çš„è‚¡ç¥¨è³‡æ–™

        // å–å¾— URL åƒæ•¸
        function getUrlParams() {
            const params = new URLSearchParams(window.location.search);
            return {
                sort: params.get('sort')
            };
        }

        // æ›´æ–° URL åƒæ•¸
        function updateUrlParams(sort) {
            const params = new URLSearchParams();
            if (sort) params.set('sort', sort);
            const newUrl = `${window.location.pathname}${params.toString() ? '?' + params.toString() : ''}`;
            window.history.replaceState({}, '', newUrl);
        }

        async function loadData() {
            try {
                // è‡ªå‹•åµæ¸¬ç’°å¢ƒï¼šGitHub Pages æˆ–æœ¬åœ°é–‹ç™¼
                // GitHub Pages: /stock_data/data_fubon/...
                // æœ¬åœ°: ../data_fubon/...
                const isGitHubPages = window.location.hostname.includes('github.io');
                const basePath = isGitHubPages ? '/stock_data' : '..';
                const dataPath = `${basePath}/data_fubon/fubon_20260121_stock_data.json`;

                const response = await fetch(dataPath);
                if (!response.ok) {
                    throw new Error('ç„¡æ³•è¼‰å…¥è³‡æ–™');
                }

                // å¾æª”åæå–æ—¥æœŸ (å‡è¨­æ ¼å¼: ...fubon_YYYYMMDD_stock_data.json)
                const dateMatch = dataPath.match(/fubon_(\d{8})_stock_data\.json/);
                if (dateMatch && dateMatch[1]) {
                    const dateStr = dateMatch[1];
                    const formattedDate = `${dateStr.substring(0, 4)}/${dateStr.substring(4, 6)}/${dateStr.substring(6, 8)}`;
                    document.getElementById('dataDate').textContent = `è³‡æ–™æ—¥æœŸï¼š${formattedDate}`;
                }

                const data = await response.json();

                // è¼‰å…¥æ‰€æœ‰æœ‰ ForeignInvestors è³‡æ–™çš„è‚¡ç¥¨ï¼ˆè‡³å°‘ 4 å¤©ï¼‰
                allFilteredStocks = [];

                for (const [stockCode, stockData] of Object.entries(data)) {
                    const foreignInvestors = stockData.ForeignInvestors;

                    // æª¢æŸ¥æ˜¯å¦æœ‰ ForeignInvestors è³‡æ–™ä¸”è‡³å°‘æœ‰ 4 å¤©
                    if (foreignInvestors && foreignInvestors.length >= 4) {
                        const firstFour = foreignInvestors.slice(0, 4);
                        const total = firstFour.reduce((sum, val) => sum + val, 0);
                        const average = Math.round(total / 4);

                        // è¨ˆç®—ç¬¬1å¤©åˆ°ç¬¬2å¤©çš„æˆé•·ç‡
                        const growthRate = firstFour[1] !== 0
                            ? ((firstFour[0] - firstFour[1]) / Math.abs(firstFour[1]) * 100)
                            : 0;

                        // è¨ˆç®—å¾ç¬¬ 1 å¤©é–‹å§‹é€£çºŒè²·è¶…çš„å¤©æ•¸
                        let consecutiveDays = 0;
                        for (let i = 0; i < foreignInvestors.length; i++) {
                            if (foreignInvestors[i] > 0) {
                                consecutiveDays++;
                            } else {
                                break;
                            }
                        }

                        allFilteredStocks.push({
                            code: stockCode,
                            name: stockData.StockName || '',
                            day1: firstFour[0],
                            day2: firstFour[1],
                            day3: firstFour[2],
                            day4: firstFour[3],
                            total: total,
                            average: average,
                            growthRate: growthRate,
                            consecutiveDays: consecutiveDays,
                            foreignInvestors: foreignInvestors
                        });
                    }
                }

                // æª¢æŸ¥ URL åƒæ•¸ä¸¦è¨­å®šä¸‹æ‹‰é¸å–®
                const urlParams = getUrlParams();
                const validSortOptions = ['total', 'growth', 'three-days', 'consecutive'];

                // å¦‚æœ URL æœ‰åƒæ•¸ï¼Œä½¿ç”¨åƒæ•¸ï¼›å¦å‰‡ä¿æŒé è¨­å€¼ (consecutive)
                if (urlParams.sort && validSortOptions.includes(urlParams.sort)) {
                    document.getElementById('sortSelect').value = urlParams.sort;
                } else {
                    // è‹¥ç„¡ URL åƒæ•¸ï¼Œç¢ºä¿é¸å–®å’Œè®Šæ•¸éƒ½è¨­ç‚ºé è¨­å€¼
                    document.getElementById('sortSelect').value = 'consecutive';
                    // ä¸¦ä¸”æ›´æ–° URL ç‚ºé è¨­å€¼ï¼Œé€™æ¨£åˆ†äº«é€£çµæ™‚æ‰æœƒä¸€è‡´ (é¸æ“‡æ€§)
                    // updateUrlParams('consecutive'); 
                }

                // åˆå§‹æ’åºï¼ˆä¾ç…§ä¸‹æ‹‰é¸å–®å€¼ï¼‰
                sortStocks();

                // æ›´æ–°çµ±è¨ˆè³‡è¨Š
                updateStats();

                // é¡¯ç¤ºè¡¨æ ¼ï¼Œéš±è—è¼‰å…¥ä¸­
                document.getElementById('loading').style.display = 'none';
                document.getElementById('stockTable').style.display = 'table';

            } catch (error) {
                console.error('è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤:', error);
                document.getElementById('loading').style.display = 'none';
                const errorDiv = document.getElementById('error');
                errorDiv.style.display = 'block';
                errorDiv.className = 'error';
                errorDiv.textContent = 'è¼‰å…¥è³‡æ–™æ™‚ç™¼ç”ŸéŒ¯èª¤: ' + error.message;
            }
        }

        function sortStocks() {
            const sortBy = document.getElementById('sortSelect').value;

            // æ›´æ–° URL åƒæ•¸
            updateUrlParams(sortBy);

            let stocksToDisplay = [];

            if (sortBy === 'total') {
                // ç¯©é¸å‡ºå‰å››å¤©éƒ½æ˜¯æ­£æ•¸çš„è‚¡ç¥¨
                stocksToDisplay = allFilteredStocks.filter(stock => {
                    return stock.day1 > 0 && stock.day2 > 0 && stock.day3 > 0 && stock.day4 > 0;
                });
                // æŒ‰ç…§ 4 æ—¥ç´¯è¨ˆæ’åºï¼ˆç”±å¤§åˆ°å°ï¼‰
                stocksToDisplay.sort((a, b) => b.total - a.total);
            } else if (sortBy === 'growth') {
                // ç¯©é¸å‡ºå‰å››å¤©éƒ½æ˜¯æ­£æ•¸çš„è‚¡ç¥¨
                stocksToDisplay = allFilteredStocks.filter(stock => {
                    return stock.day1 > 0 && stock.day2 > 0 && stock.day3 > 0 && stock.day4 > 0;
                });
                // æŒ‰ç…§æˆé•·ç‡æ’åºï¼ˆç”±å¤§åˆ°å°ï¼‰
                stocksToDisplay.sort((a, b) => b.growthRate - a.growthRate);
            } else if (sortBy === 'three-days') {
                // ç¯©é¸å‡ºå››å¤©ä¸­è‡³å°‘æœ‰ä¸‰å¤©æ˜¯æ­£æ•¸çš„è‚¡ç¥¨
                stocksToDisplay = allFilteredStocks.filter(stock => {
                    const positiveDays = [stock.day1, stock.day2, stock.day3, stock.day4].filter(val => val > 0).length;
                    return positiveDays >= 3;
                });
                // æŒ‰ç…§ 4 æ—¥ç´¯è¨ˆæ’åºï¼ˆç”±å¤§åˆ°å°ï¼‰
                stocksToDisplay.sort((a, b) => b.total - a.total);
            } else if (sortBy === 'consecutive') {
                // ç¯©é¸å‡ºè‡³å°‘é€£çºŒ 1 å¤©è²·è¶…çš„è‚¡ç¥¨
                stocksToDisplay = allFilteredStocks.filter(stock => stock.consecutiveDays >= 1);
                // æŒ‰ç…§é€£çºŒè²·è¶…å¤©æ•¸æ’åºï¼ˆç”±å¤§åˆ°å°ï¼‰ï¼Œå¤©æ•¸ç›¸åŒæ™‚æŒ‰é€£çºŒæœŸé–“ç´¯è¨ˆæ’åº
                stocksToDisplay.sort((a, b) => {
                    if (b.consecutiveDays !== a.consecutiveDays) {
                        return b.consecutiveDays - a.consecutiveDays;
                    }
                    // è¨ˆç®—é€£çºŒæœŸé–“çš„ç´¯è¨ˆè²·è¶…
                    const aConsecutiveTotal = a.foreignInvestors.slice(0, a.consecutiveDays).reduce((sum, val) => sum + val, 0);
                    const bConsecutiveTotal = b.foreignInvestors.slice(0, b.consecutiveDays).reduce((sum, val) => sum + val, 0);
                    return bConsecutiveTotal - aConsecutiveTotal;
                });
            }

            // é‡æ–°æ¸²æŸ“è¡¨æ ¼
            renderTable(stocksToDisplay, sortBy);

            // æ›´æ–°çµ±è¨ˆè³‡è¨Š
            updateStats(stocksToDisplay, sortBy);
        }

        function renderTable(stocks = allFilteredStocks, sortBy = 'total') {
            const tableBody = document.getElementById('tableBody');
            const tableHead = document.getElementById('tableHead');
            tableBody.innerHTML = '';

            // æ ¹æ“šæ•¸å€¼æ±ºå®šé¡è‰²é¡åˆ¥çš„å‡½æ•¸
            const getColorClass = (value) => {
                if (value > 0 && value < 1000) {
                    return 'neutral';  // æ­£æ•¸ä½†å°æ–¼ 1000ï¼Œç”¨é»‘è‰²
                } else if (value > 0) {
                    return 'positive'; // æ­£æ•¸ä¸” >= 1000ï¼Œç”¨ç´…è‰²
                } else if (value < 0) {
                    return 'negative'; // è² æ•¸ï¼Œç”¨ç¶ è‰²
                } else {
                    return '';         // 0ï¼Œç„¡ç‰¹æ®Šé¡è‰²
                }
            };

            // æ ¹æ“šæ’åºæ¨¡å¼è¨­å®šè¡¨é ­
            if (sortBy === 'consecutive') {
                // 10 å¤©æ¨¡å¼ï¼šé¡¯ç¤ºæ‰€æœ‰ 10 å¤©è³‡æ–™
                tableHead.innerHTML = `
                    <tr>
                        <th>è‚¡ç¥¨ä»£è™Ÿ</th>
                        <th>è‚¡ç¥¨åç¨±</th>
                        <th>é€£çºŒå¤©æ•¸</th>
                        <th>ç¬¬1å¤©</th>
                        <th>ç¬¬2å¤©</th>
                        <th>ç¬¬3å¤©</th>
                        <th>ç¬¬4å¤©</th>
                        <th>ç¬¬5å¤©</th>
                        <th>ç¬¬6å¤©</th>
                        <th>ç¬¬7å¤©</th>
                        <th>ç¬¬8å¤©</th>
                        <th>ç¬¬9å¤©</th>
                        <th>ç¬¬10å¤©</th>
                        <th>10æ—¥ç´¯è¨ˆ</th>
                        <th>10æ—¥å¹³å‡</th>
                    </tr>
                `;

                stocks.forEach(stock => {
                    const row = document.createElement('tr');
                    const fi = stock.foreignInvestors;

                    // è¨ˆç®— 10 æ—¥ç´¯è¨ˆå’Œå¹³å‡
                    const total10 = fi.slice(0, 10).reduce((sum, val) => sum + val, 0);
                    const avg10 = Math.round(total10 / 10);

                    // ç”Ÿæˆæ¯å¤©çš„ td
                    let daysCells = '';
                    for (let i = 0; i < 10; i++) {
                        const value = fi[i] || 0;
                        const colorClass = getColorClass(value);
                        daysCells += `<td class="${colorClass}">${value.toLocaleString()}</td>`;
                    }

                    row.innerHTML = `
                        <td class="stock-code"><a href="https://fubon-ebrokerdj.fbs.com.tw/z/zc/zcw/zcw1_${stock.code}.djhtm" target="_blank">${stock.code}</a></td>
                        <td>${stock.name}</td>
                        <td style="font-weight: bold; color: #667eea;">${stock.consecutiveDays}</td>
                        ${daysCells}
                        <td class="${getColorClass(total10)}" style="font-weight: bold;">${total10.toLocaleString()}</td>
                        <td class="${getColorClass(avg10)}">${avg10.toLocaleString()}</td>
                    `;
                    tableBody.appendChild(row);
                });
            } else {
                // 4 å¤©æ¨¡å¼ï¼šåŸæœ¬çš„é¡¯ç¤ºé‚è¼¯
                tableHead.innerHTML = `
                    <tr>
                        <th>è‚¡ç¥¨ä»£è™Ÿ</th>
                        <th>è‚¡ç¥¨åç¨±</th>
                        <th>ç¬¬1å¤©</th>
                        <th>ç¬¬2å¤©</th>
                        <th>ç¬¬3å¤©</th>
                        <th>ç¬¬4å¤©</th>
                        <th>4æ—¥ç´¯è¨ˆ</th>
                        <th>å¹³å‡æ¯æ—¥</th>
                    </tr>
                `;

                stocks.forEach(stock => {
                    const row = document.createElement('tr');

                    // æ ¹æ“šæ•¸å€¼æ­£è² è¨­å®šé¡è‰²é¡åˆ¥
                    const day1Class = getColorClass(stock.day1);
                    const day2Class = getColorClass(stock.day2);
                    const day3Class = getColorClass(stock.day3);
                    const day4Class = getColorClass(stock.day4);
                    const totalClass = getColorClass(stock.total);
                    const avgClass = getColorClass(stock.average);

                    row.innerHTML = `
                        <td class="stock-code"><a href="https://fubon-ebrokerdj.fbs.com.tw/z/zc/zcw/zcw1_${stock.code}.djhtm" target="_blank">${stock.code}</a></td>
                        <td>${stock.name}</td>
                        <td class="${day1Class}">${stock.day1.toLocaleString()}</td>
                        <td class="${day2Class}">${stock.day2.toLocaleString()}</td>
                        <td class="${day3Class}">${stock.day3.toLocaleString()}</td>
                        <td class="${day4Class}">${stock.day4.toLocaleString()}</td>
                        <td class="${totalClass}" style="font-weight: bold;">${stock.total.toLocaleString()}</td>
                        <td class="${avgClass}">${stock.average.toLocaleString()}</td>
                    `;
                    tableBody.appendChild(row);
                });
            }
        }

        function updateStats(stocks = allFilteredStocks, sortBy = 'total') {
            if (sortBy === 'consecutive') {
                // 10 æ—¥æ¨¡å¼çµ±è¨ˆ
                const total10Buy = stocks.reduce((sum, stock) => {
                    const t10 = stock.foreignInvestors.slice(0, 10).reduce((s, v) => s + v, 0);
                    return sum + t10;
                }, 0);
                const avg10Buy = stocks.length > 0 ? Math.round(total10Buy / stocks.length) : 0;

                document.getElementById('totalStocks').textContent = stocks.length;
                document.getElementById('totalBuy').textContent = total10Buy.toLocaleString();
                document.getElementById('avgBuy').textContent = avg10Buy.toLocaleString();

                // æ›´æ–°æ¨™ç±¤
                document.querySelector('#stats .stat-card:nth-child(2) .stat-label').textContent = '10æ—¥ç´¯è¨ˆè²·è¶…ï¼ˆå¼µï¼‰';
                document.querySelector('#stats .stat-card:nth-child(3) .stat-label').textContent = 'å¹³å‡10æ—¥è²·è¶…ï¼ˆå¼µï¼‰';
            } else {
                // 4 æ—¥æ¨¡å¼çµ±è¨ˆ
                const totalBuy = stocks.reduce((sum, stock) => sum + stock.total, 0);
                const avgBuy = stocks.length > 0 ? Math.round(totalBuy / stocks.length) : 0;

                document.getElementById('totalStocks').textContent = stocks.length;
                document.getElementById('totalBuy').textContent = totalBuy.toLocaleString();
                document.getElementById('avgBuy').textContent = avgBuy.toLocaleString();

                // æ¢å¾©æ¨™ç±¤
                document.querySelector('#stats .stat-card:nth-child(2) .stat-label').textContent = '4æ—¥ç´¯è¨ˆè²·è¶…ï¼ˆå¼µï¼‰';
                document.querySelector('#stats .stat-card:nth-child(3) .stat-label').textContent = 'å¹³å‡æ¯æ—¥è²·è¶…ï¼ˆå¼µï¼‰';
            }
        }

        // é é¢è¼‰å…¥æ™‚åŸ·è¡Œ
        loadData();
    </script>
</body>

</html>